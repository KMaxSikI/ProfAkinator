# Telegram Карьерный Бот-Акинатор

Этот проект представляет собой карьерного Telegram-бота-акинатора, который помогает пользователям пройти тест на профориентацию и подобрать наиболее подходящую профессию. Бот работает на основе Aiogram и использует базу данных SQLite для хранения данных о пользователях и их ответах.

## Содержание

- [Функциональность](#функциональность)
- [Структура проекта](#структура-проекта)
  - [Основные модули](#основные-модули)
- [Установка и запуск](#установка-и-запуск)
  - [Предварительные требования](#предварительные-требования)
  - [Настройка базы данных](#настройка-базы-данных)
  - [Запуск бота](#запуск-бота)
- [Использование Google Sheets для данных](#использование-google-sheets-для-данных)
- [Используемые библиотеки](#используемые-библиотеки)
- [Лицензия](#лицензия)

---

## Функциональность

1. **Тест на профориентацию**: Бот предлагает пройти тест из 61 вопроса, по результатам которого определяется наиболее подходящая профессия.
2. **Обработка и сохранение ответов**: Ответы пользователей сохраняются в базе данных, и по ним вычисляется результат.
3. **Поддержка Google Sheets**: Данные для теста могут быть загружены из Google Sheets, чтобы упростить обновление информации о профессиях и тестах.
4. **Повторное прохождение теста**: Пользователь может пройти тест повторно, при этом каждый результат будет сохраняться в базе данных как новая сессия.

## Структура проекта

- `handlers/`: Папка с модулями обработки сообщений от пользователей.
  - `start.py`: Хендлер для команды `/start` — запуск бота и приветственное сообщение.
  - `test.py`: Модуль управления тестом, включает хендлеры для запуска теста, обработки ответов и отображения результатов.
  - `result.py`: Модуль обработки результатов теста, который выводит пользователю итоговую профессию.
  - `error.py`: Обработка ошибок, чтобы пользователю отображались корректные сообщения.
- `services/`: Папка с модулями логики обработки теста и работы с базой данных.
  - `test_service.py`: Логика обработки вопросов и ответов, а также взаимодействие с базой данных для записи ответов.
  - `result_service.py`: Логика расчета результатов теста и определения профессии.
- `career_bot/`: Папка для работы с базой данных.
  - `db.py`: Определение моделей базы данных и инициализация подключения.
  - `load_data.py`: Модуль для загрузки данных о профессиях и тесте из Google Sheets в базу данных.
  - `update_short_answers.py`: Модуль, который устанавливает краткие ответы (например, A, B, C, D) для корректного сопоставления с полными ответами в базе данных. **Важно** запускать этот модуль после `load_data.py`, а также обновлять его при добавлении или изменении вопросов.
  - `keyboards.py`: Определение клавиатур для взаимодействия с пользователем, включая кнопки ответов на тест и кнопки для повторного прохождения теста.
  - `main.py`: Основной файл, запускающий бота и регистрирующий хендлеры для обработки команд и сообщений.
  - `loader.py`: Модуль инициализации бота и диспетчера для управления ботом в других модулях.
    ```python
    from aiogram import Bot, Dispatcher
    from config import BOT_TOKEN
    
    bot = Bot(token=BOT_TOKEN)
    dp = Dispatcher(bot)
  - `config.py`: Файл для хранения конфигураций проекта, таких как токен бота и другие параметры.
    ```python
    import os
    
    BOT_TOKEN = os.getenv("BOT_TOKEN", "вставить токен от своего телеграмм бота")

    
## Установка и запуск

### Предварительные требования

1. Python 3.8+
2. Установить зависимости из файла `requirements.txt`
   ```bash
   pip install requirements.txt

### Настройка базы данных
1. Создайте новую базу данных SQLite для хранения информации.
2. Запустите скрипт `load_data.py`, чтобы загрузить данные из файлов Excel или Google Sheets в базу данных.
   - **Примечание:** Убедитесь, что ссылки на Google Sheets опубликованы для общего доступа и имеют формат CSV для корректного чтения данных.
3. После выполнения `load_data.py` необходимо запустить скрипт `update_short_answers.py`, чтобы заполнить сокращенные ответы, соответствующие полным ответам в тесте, для корректной работы бота.
   - **Важно:** Каждый раз после запуска `load_data.py` необходимо повторно запускать `update_short_answers.py`.
   - Если вы добавляете или удаляете вопросы в тесте, не забудьте отредактировать `update_short_answers.py`, чтобы он соответствовал новой структуре теста.
4. Проверьте, что база данных содержит все необходимые таблицы: `professions`, `questions`, `answers`, `user_test_records`.
   
### Запуск бота

1. Откройте файл `config.py` и укажите в нем токен вашего Telegram-бота:

    ```python
    import os
    
    BOT_TOKEN = os.getenv("BOT_TOKEN", "вставить токен от своего телеграмм бота")

2. Запустите `main.py`:


3. Бот начнет работать и будет готов к получению сообщений от пользователей.

### Использование Google Sheets для данных

1. Создайте две таблицы Google Sheets: одну для данных теста, другую для данных о профессиях.
2. Опубликуйте Google Sheets для общего доступа и сохраните ссылки.
3. Убедитесь, что в `load_data.py` ссылки на Google Sheets указывают на формат CSV, например:
    
   ```python
    test_file_url = "https://docs.google.com/spreadsheets/d/your_test_sheet_id/export?format=csv"
    professions_file_url = "https://docs.google.com/spreadsheets/d/your_profession_sheet_id/export?format=csv"

4. Запустите скрипт `load_data.py`, чтобы обновить базу данных актуальными данными из Google Sheets. При этом не забываем после скорретировать, при необходимости,
и запустить скрипт `update_short_answers.py`.

### Используемые библиотеки

  - **Aiogram** — для создания Telegram-бота и обработки сообщений.
  - **SQLAlchemy** — для работы с базой данных SQLite.
  - **Pandas** — для обработки данных из файлов Excel и Google Sheets.
  - **GSpread и Google-auth** — для подключения к Google Sheets API.